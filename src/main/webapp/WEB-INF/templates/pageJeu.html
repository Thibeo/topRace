<!DOCTYPE html>

<html xmlns:th="http://www.thymeleaf.org">

    <head>
    	<title>TOP RACE - Jouer</title>
        <meta charset='utf-8'>
        <link rel='stylesheet' href='css/pageJeu.css'>
        <link rel='stylesheet' href='css/menu.css'> <!-- style du menu, du body, et du background -->
        <link rel='stylesheet' href='css/rulesParaQuitt.css'> <!-- style des div #rules et #para -->
        <link rel='stylesheet' href='css/scrollBar.css'> <!-- style de la scrollbar -->
        <link rel="shortcut icon" href="img/logo.png">
        <script type="text/javascript" src="js/rulesParaQuitt.js"></script>
<script type="text/javascript">

    function avancerVoiture(couleur, top, left, rotate) {
        var voiture = document.getElementById("joueur"+couleur);
        voiture.style.top = top+"vh";
        voiture.style.left = left+"vh";
        voiture.style.transform = "rotate("+rotate+"deg)";
    }

    function avancer(cse){
        if (cse != 27 && cse != 28 && cse != 29 && cse != 31 && cse != 32 && cse != 33 && cse != 34 && cse != 35 && cse != 36
                                                && cse != 41 && cse != 42 && cse != 43 && cse != 44 && cse != 45 && cse != 46) {
            var postMyOpinionRequest = new XMLHttpRequest();
            postMyOpinionRequest.open("POST", "webservices/game/test", true);
            postMyOpinionRequest.responseType = "json";
            postMyOpinionRequest.onload = function () {
                var answer = this.response;
                console.log("answer: " + answer);
                var longeur = parseInt(answer[0]);
                console.log("nb changement = " + longeur);
                var i = 1;
                for (var j = 0; j < longeur; j++) {
                    var top = "";
                    var left = "";
                    var couleur = "";
                    var rotate = "";
                    var comt = "";
                    i = i + 1;
                    while (answer[i] != '-') {
                        if (answer[i] == '#') {
                            couleur = comt;
                            comt = "";
                            i = i + 1;
                        } else if (answer[i] == "/") {
                            top = comt;
                            comt = "";
                            i = i + 1;
                        } else if (answer[i] == "+") {
                            left = comt;
                            comt = "";
                            i = i + 1;
                        } else {
                            comt = comt + answer[i];
                            i = i + 1;
                        }
                    }
                    rotate = comt;
                    console.log("la voiture qui est " + couleur + " se trouve en top = " + top + " et left = " + left);
                    avancerVoiture(couleur, top, left, rotate);
                }

                console.log("");

            }
            postMyOpinionRequest.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            postMyOpinionRequest.send("data=" + JSON.stringify(cse));
            /* et on l'envoit */
        } else {
            var eltIdCartes = document.getElementById("idCarte");
            var idCart = document.createTextNode(cse);
            eltIdCartes.replaceChild(idCart, eltIdCartes.firstChild);
            var eltLaCarte = document.getElementById("imgLaCarte");
            var bkgd = "url(img/cartes/"+cse+".png)";
            eltLaCarte.style.backgroundImage= bkgd;
            if (cse == 31){ document.getElementById("jaune").disabled = true; }
            if (cse == 32){ document.getElementById("rouge").disabled = true; }
            if (cse == 33){ document.getElementById("violette").disabled = true; }
            if (cse == 34){ document.getElementById("bleue").disabled = true; }
            if (cse == 35){ document.getElementById("verte").disabled = true; }
            if (cse == 36){ document.getElementById("blanche").disabled = true; }
            if (cse == 41 || cse == 42 || cse == 43){ document.getElementById("jaune").disabled = true;
                                                      document.getElementById("bleue").disabled = true;
                                                      document.getElementById("blanche").disabled = true; }
            if (cse == 44 || cse == 45 || cse == 46){ document.getElementById("violette").disabled = true;
                                                      document.getElementById("rouge").disabled = true;
                                                      document.getElementById("verte").disabled = true; }
            AfficherCacher("choixCartes");
            AfficherCacher("fondChoixCartes");
        }

    }

    function choixCartes() {
        var bool = false;
        var elems = document.getElementsByName("couleurCarte");
        for (i = 0; i < elems.length; i++) {
                if (elems[i].checked) {
                    bool = true;
                }

        }
        if (bool == true){
            var couleur = document.fromChoixCarte.couleurCarte.value;
            console.log("couleur choisie = "+couleur);
            var eltIdCartes = document.getElementById("idCarte");
            var idCartes = eltIdCartes.innerText || eltIdCartes.textContent;
            console.log("id carte = "+idCartes);
            for (i = 0; i < elems.length; i++) {
                elems[i].checked = false;
                elems[i].disabled = false;
            }
            AfficherCacher("choixCartes");
            AfficherCacher("fondChoixCartes");
            avancer(idCartes+couleur);
        }else{
            alert("tu doit choisis une couleur !");
        }
    }

    function inverse(ID, COL){
      var table = document.getElementById(ID);      
      var nom = navigator.appName;
      if (nom == 'Netscape'){
        var detail=document.getElementsByName(COL);
      } else {
        var detail=getCellByName(table,COL);
      }
      if (detail[0].style.display == ""){
        for(var i = 0; i < detail.length; ++i) detail[i].style.display = "none";
      } else {
        for(var i = 0; i < detail.length; ++i) detail[i].style.display = "";
      }
    }

    function getCellByName(tab, nom){
          var cols=new Array();
          cellules=tab.getElementsByTagName("td");
          for(var i = 0; i < cellules.length; ++i){
              if(cellules[i].name==nom){
                  cols[cols.length]=cellules[i];
              }
          }
          return cols;
    }

    function plusUn() {
        var elt = document.getElementById("compteur");
        var y = elt.innerText || elt.textContent;
        var num = parseInt(y);
        var n = (num+1).toString();
        var z = document.createTextNode(n);
        elt.replaceChild(z, elt.firstChild);
    }

    function moinsUn() {
        var elt = document.getElementById("compteur");
        var y = elt.innerText || elt.textContent;
        var num = parseInt(y);
        var n = (num-1).toString();
        var z = document.createTextNode(n);
        elt.replaceChild(z, elt.firstChild);
    }

    function cartesTaille(){
        var elt = document.getElementById("compteur");
        var y = elt.innerText || elt.textContent;
        var num = parseInt(y);
        var taille = document.getElementById("ligneCartes");
        var carreHaut = document.getElementById("carreHaut");
        var carreBas = document.getElementById("carreBas");
        var marg = document.querySelectorAll(".imagee");
        if (num == 3) {
            taille.style.width = "152vh";
            console.log(carreBas.style.left);
            carreBas.style.left = "167.1vh";
            carreHaut.style.left = "167.1vh";
            for (var i = 0; i < marg.length; ++i){
                marg[i].style.margin = "0.79vh";
            }
        } else if (num == 2) {
            taille.style.width = "139vh";
            carreBas.style.left = "154.1vh";
            carreHaut.style.left = "154.1vh";
            for (var i = 0; i < marg.length; ++i){
                marg[i].style.margin = "1.04vh";
            }
        } else if (num == 1) {
            taille.style.width = "126vh";
            carreBas.style.left = "141vh";
            carreHaut.style.left = "141vh";
            for (var i = 0; i < marg.length; ++i){
                marg[i].style.margin = "1.32vh";
            }
        } else if (num == 0) {
            taille.style.width = "113vh";
            carreBas.style.left = "128vh";
            carreHaut.style.left = "128vh";
            for (var i = 0; i < marg.length; ++i){
                marg[i].style.margin = "1.68vh";
            }
        }
    }





    function check(){
        var un = document.querySelectorAll(".pariUn");
        var deux = document.querySelectorAll(".pariDeux");
        var trois = document.querySelectorAll(".pariTrois");

        var i = 0,
            k = 0,
            j = 0;

        for (; i<6; i++){
            un[i].addEventListener("change", function (){
                if (document.querySelectorAll(".pariUn:checked").length > 3){
                    this.checked = false;}
            }, false);}
          
        for (; j<6; j++){
            deux[j].addEventListener("change", function (){
                if (document.querySelectorAll(".pariDeux:checked").length > 3){
                  this.checked = false;}
            }, false);}

        for (; k<6; k++){
            trois[k].addEventListener("change", function (){
                if (document.querySelectorAll(".pariTrois:checked").length > 3){
                  this.checked = false;}
            }, false);}
        }
 
  </script>

    </head>

    <body onload="inverse('tb', 'col0');inverse('tb', 'col1');inverse('tb', 'col2');inverse('tb', 'col6');inverse('tb', 'col7');inverse('tb', 'col8');check();Cacher('choixCartes');Cacher('fondChoixCartes');Cacher('fondPara');Cacher('fondRules');Cacher('rules');Cacher('para');Cacher('quitter');Cacher('fondQuitter');avancer(0);">

<!-- HEADER -->
        <header th:replace="~{fragments::header}"></header>

<!-- CONTENU -->
    	<section class="page">
        <nav id="compteur">3</nav>
            <div th:replace="~{fragments::rulesParaQuitt}"></div>
            <nav class="fond" id="fondChoixCartes"></nav>
            <nav id="choixCartes">
                <p id="idCarte" style="visibility: hidden;position:fixed;">0</p>
                <h2 style="text-align: center; margin-bottom: 0px;">Choix de la couleur de la voiture</h2>
                <h2 style="text-align: center; margin-top: 0px;">à faire avancer de 5 cases</h2>
                <p style="text-align: center; margin-bottom: 0px;">(Vous ne pouvez pas choisir une</p>
                <p style="text-align: center; margin-top: 0px;">couleur déjà présente sur la carte)</p>
                <form name='fromChoixCarte'><table align="center" style="margin-top: 40px">
                        <tr class="choixJaune">
                            <td style="color:#ffd800;font-weight: bold;font-size: 22px;">Jaune</td>
                            <td align="center"><input type="radio" name="couleurCarte" value="Jaune" id="jaune" /><label for="jaune"></label></td>
                            <td align="center" class="laCarte">Votre carte :</td>
                        </tr>
                        <tr class="choixBleue">
                            <td style="color:#2551d9;font-weight: bold;font-size: 22px;">Bleue</td>
                            <td align="center"><input type="radio" name="couleurCarte" value="Bleu" id="bleue" /><label for="bleue"></label></td>
                            <td rowspan="5" id="laCarte" class="laCarte"><nav id="imgLaCarte" class="imagee" style="background-image: url(img/cartes/1.png);background-size: cover;'}"></nav></td>
                        </tr>
                        <tr class="choixRouge">
                            <td style="color:#fb2b2b;font-weight: bold;font-size: 22px;">Rouge</td>
                            <td align="center"><input type="radio" name="couleurCarte" value="Rouge" id="rouge" /><label for="rouge"></label></td>
                        </tr>
                        <tr class="choixViolette">
                            <td style="color:#864daf;font-weight: bold;font-size: 22px;">Violette</td>
                            <td align="center"><input type="radio" name="couleurCarte" value="Violet" id="violette" /><label for="violette"></label></td>
                        </tr>
                        <tr class="choixBlanche">
                            <td style="color:white;font-weight: bold;font-size: 22px;">Blanche</td>
                            <td align="center"><input type="radio" name="couleurCarte" value="Blanc" id="blanche" /><label for="blanche"></label></td>
                        </tr>
                        <tr class="choixVerte">
                            <td style="color:#2fb129;font-weight: bold;font-size: 22px;">Verte</td>
                            <td align="center"><input type="radio" name="couleurCarte" value="Vert" id="verte" /><label for="verte"></label></td>
                        </tr>
                        <tr class="choixBoutton">
                            <td class="btnChoix btnLaCarte" colspan="3" align="center"><button type="button" onclick="choixCartes()">Valider</button></td>
                        </tr>
                    </table>
                </form>
            </nav>

    		<nav class="bande1"></nav>
    		<nav class="contenu">
    			<nav class="ligne1">
    				<nav class="joueurs">
						<nav class="j1">- Joueur 1</nav>
						<nav class="j2">- Joueur 2</nav>
						<nav class="j3">- Joueur 3</nav>
						<nav class="j4">- Joueur 4</nav>
						<nav class="j5">- Joueur 5</nav>
						<nav class="j6">- Joueur 6</nav>
    				</nav>
    				<nav class="plateau">
    				</nav>
    				<nav class="plateauParis">
                        <table id="tb">
                            <tr>
                                <td><button class="bouttonJaune" name="col6" onclick="inverse('tb', 'col0');
                                                                                      inverse('tb', 'col3');
                                                                                      inverse('tb', 'col6');
                                                                                      plusUn();
                                                                                      cartesTaille();">1</button>

                                    <button class="bouttonRouge" name="col3" onclick="inverse('tb', 'col0');
                                                                                      inverse('tb', 'col6');
                                                                                      inverse('tb', 'col3');
                                                                                      moinsUn();
                                                                                      cartesTaille();">1</button></td>
                                <td rowspan="3">Couleur</td>
                                <td class="colonnePari" name="col0" rowspan="3" align="center">1er pari</td>
                                <td class="colonnePari" name="col1" rowspan="3" align="center">2ème pari</td>
                                <td class="colonnePari" name="col2" rowspan="3" align="center">3ème pari</td>
                            </tr>
                             <tr>
                                <td><button class="bouttonJaune" name="col7" onclick="inverse('tb', 'col1');
                                                                                      inverse('tb', 'col4');
                                                                                      inverse('tb', 'col7');
                                                                                      plusUn();
                                                                                      cartesTaille();">2</button>
                                    <button class="bouttonRouge" name="col4" onclick="inverse('tb', 'col1');
                                                                                      inverse('tb', 'col7');
                                                                                      inverse('tb', 'col4');
                                                                                      moinsUn();
                                                                                      cartesTaille();">2</button></td>
                            </tr>
                             <tr>
                                <td><button class="bouttonJaune" name="col8" onclick="inverse('tb', 'col2');
                                                                                      inverse('tb', 'col5');
                                                                                      inverse('tb', 'col8');
                                                                                      plusUn();
                                                                                      cartesTaille();">3</button>
                                    <button class="bouttonRouge" name="col5" onclick="inverse('tb', 'col2');
                                                                                      inverse('tb', 'col8');
                                                                                      inverse('tb', 'col5');
                                                                                      moinsUn();
                                                                                      cartesTaille();">3</button></td>
                            </tr>
                            <tr class="pariReponseJaune">
                                <td colspan="2">Jaune</td>
                                <td class="colonnePari" name="col0" align="center"><input class="pariUn" type="checkbox" name="jaune1" id="jaune1" /><label for="jaune1"></label></td>
                                <td class="colonnePari" name="col1" align="center"><input class="pariDeux" type="checkbox" name="jaune2" id="jaune2" /><label for="jaune2"></label></td>
                                <td class="colonnePari" name="col2" align="center"><input class="pariTrois" type="checkbox" name="jaune3" id="jaune3" /><label for="jaune3"></label></td>
                            </tr>
                            <tr class="pariReponseBleue">
                                <td colspan="2">Bleue</td>
                                <td class="colonnePari" name="col0" align="center"><input class="pariUn" type="checkbox" name="bleue1" id="bleue1" /><label for="bleue1"></label></td>
                                <td class="colonnePari" name="col1" align="center"><input class="pariDeux" type="checkbox" name="bleue2" id="bleue2" /><label for="bleue2"></label></td>
                                <td class="colonnePari" name="col2" align="center"><input class="pariTrois" type="checkbox" name="bleue3" id="bleue3" /><label for="bleue3"></label></td>
                            </tr>
                            <tr class="pariReponseRouge">
                                <td colspan="2">Rouge</td>
                                <td class="colonnePari" name="col0" align="center"><input class="pariUn" type="checkbox" name="rouge1" id="rouge1" /><label for="rouge1"></label></td>
                                <td class="colonnePari" name="col1" align="center"><input class="pariDeux" type="checkbox" name="rouge2" id="rouge2" /><label for="rouge2"></label></td>
                                <td class="colonnePari" name="col2" align="center"><input class="pariTrois" type="checkbox" name="rouge3" id="rouge3" /><label for="rouge3"></label></td>
                            </tr>
                            <tr class="pariReponseViolette">
                                <td colspan="2">Violette</td>
                                <td class="colonnePari" name="col0" align="center"><input class="pariUn" type="checkbox" name="violette1" id="violette1" /><label for="violette1"></label></td>
                                <td class="colonnePari" name="col1" align="center"><input class="pariDeux" type="checkbox" name="violette2" id="violette2" /><label for="violette2"></label></td>
                                <td class="colonnePari" name="col2" align="center"><input class="pariTrois" type="checkbox" name="violette3" id="violette3" /><label for="violette3"></label></td>
                            </tr>
                            <tr class="pariReponseBlanche">
                                <td colspan="2">Blanche</td>
                                <td class="colonnePari" name="col0" align="center"><input class="pariUn" type="checkbox" name="blanche1" id="blanche1" /><label for="blanche1"></label></td>
                                <td class="colonnePari" name="col1" align="center"><input class="pariDeux" type="checkbox" name="blanche2" id="blanche2" /><label for="blanche2"></label></td>
                                <td class="colonnePari" name="col2" align="center"><input class="pariTrois" type="checkbox" name="blanche3" id="blanche3" /><label for="blanche3"></label></td>
                            </tr>
                            <tr class="pariReponseVerte">
                                <td colspan="2">Verte</td>
                                <td class="colonnePari" name="col0" align="center"><input class="pariUn" type="checkbox" name="verte1" id="verte1" /><label for="verte1"></label></td>
                                <td class="colonnePari" name="col1" align="center"><input class="pariDeux" type="checkbox" name="verte2" id="verte2" /><label for="verte2"></label></td>
                                <td class="colonnePari" name="col2" align="center"><input class="pariTrois" type="checkbox" name="verte3" id="verte3" /><label for="verte3"></label></td>
                            </tr>
                            <tr class="pariReponse">
                                <td colspan="2">1ère place</td>
                                <td class="colonnePari" name="col0" align="center">9 pts</td>
                                <td class="colonnePari" name="col1" align="center">6 pts</td>
                                <td class="colonnePari" name="col2" align="center">3 pts</td>
                            </tr>
                            <tr class="pariReponse">
                                <td colspan="2">2ème place</td>
                                <td class="colonnePari" name="col0" align="center">6 pts</td>
                                <td class="colonnePari" name="col1" align="center">4 pts</td>
                                <td class="colonnePari" name="col2" align="center">2 pts</td>
                            </tr>
                            <tr class="pariReponse">
                                <td colspan="2">3ème place</td>
                                <td class="colonnePari" name="col0" align="center">3 pts</td>
                                <td class="colonnePari" name="col1" align="center">2 pts</td>
                                <td class="colonnePari" name="col2" align="center">1 pts</td>
                            </tr>
                            <tr class="pariReponse">
                                <td colspan="2">4ème place</td>
                                <td class="colonnePari" name="col0" align="center">0 pts</td>
                                <td class="colonnePari" name="col1" align="center">-1 pts</td>
                                <td class="colonnePari" name="col2" align="center">-2 pts</td>
                            </tr>
                            <tr class="pariReponse">
                                <td colspan="2">5ème place</td>
                                <td class="colonnePari" name="col0" align="center">-1 pts</td>
                                <td class="colonnePari" name="col1" align="center">-3 pts</td>
                                <td class="colonnePari" name="col2" align="center">-6 pts</td>
                            </tr>
                            <tr class="pariReponse">
                                <td colspan="2">6ème place</td>
                                <td class="colonnePari" name="col0" align="center">-3 pts</td>
                                <td class="colonnePari" name="col1" align="center">-6 pts</td>
                                <td class="colonnePari" name="col2" align="center">-9 pts</td>
                            </tr>
                            <tr class="pariReponse">
                                <td colspan="2" class="vide"></td>
                                <td class="colonnePari btnValide" name="col0" align="center">
                                    <button type="submit" value="Valider">Valider</button>
                                </td>
                                <td class="colonnePari btnValide" name="col1" align="center">
                                    <button type="submit" value="Valider">Valider</button>
                                </td>
                                <td class="colonnePari btnValide" name="col2" align="center">
                                    <button type="submit" value="Valider">Valider</button>
                                </td>
                            </tr>
                            </form>
                        </table>
    				</nav>
    			</nav>

                <nav class="carteTitre">
                    <b> Cartes </b>
                </nav>
            </nav>

            <nav class="joueurVoiture" id="joueurJaune"></nav>
            <nav class="joueurVoiture" id="joueurViolet"></nav>
            <nav class="joueurVoiture" id="joueurRouge"></nav>
            <nav class="joueurVoiture" id="joueurBleu"></nav>
            <nav class="joueurVoiture" id="joueurBlanc"></nav>
            <nav class="joueurVoiture" id="joueurVert"></nav>


            <nav id="carreHaut"></nav>
            <nav id="carreBas"></nav>

    		<nav id="ligneCartes">
                <nav class="imagee" th:each="carte : ${listCarte}" th:style="${'background-image: url(img/cartes/'+carte.idCarte+'.png);background-size: cover;'}" th:id="${'carte'+carte.idCarte}" th:onclick="${'avancer('+carte.idCarte+');'}"></nav>
    		</nav>

    		<nav class="bande2"></nav>

    		<section class="footer">
                <p></p> <!--le footer est vide -->
            </section>

    	</section>

    </body>

    
    
</html>